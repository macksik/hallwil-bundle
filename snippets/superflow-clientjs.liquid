<script>
    window._sfProperties = {
          country: '{{ localization.country }}',
          theme: '{{ theme.name }}',
          pagetype: '{{ request.page_type }}',
          {% if customer.email %}
          loggedIn: true,
          userid: '{{ customer.id }}',
          firstname: '{{ customer.first_name }}',
          lastname: '{{ customer.last_name }}',
          email: '{{ customer.email }}',
          {% else %}
          loggedIn: false,
          userid: null,
          firstname: null,
          lastname: null,
          email: null,
          {% endif %}
      }
    </script>
    <script defer>/** 
* Superflow ClientJS version 1
* 
* @copyright Superflow Software GmbH (2025)
* @version v1.0.0
* @license Commercial
* @maintainer Superflow Software GmbH <devs@superflow.app>
* @maintainer_contact <devs@superflow.app>
* */
//__STATIC__TRIGGER_PAYLOAD__;
const SUPERFLOWEvs = {"95d68bea-c90b-4894-84f3-57f5cf7f6f53":{"custom":[{"id":"f6f23f4d-5c08-4459-845b-e6d679f33436_hallwil-test-task.myshopify.com","sid":"258497904911","aid":"95d68bea-c90b-4894-84f3-57f5cf7f6f53","title":"Product Added","options":{},"blob":"Ly8gcHJvZHVjdCBhZGRlZCB0byBjYXJ0IHRyaWdnZXINCg0KY29uc3QgTE9DQUxTVE9SQUdFX0tFWV9OQU1FID0gJ19DQVJUJw0KDQpmdW5jdGlvbiBnZXRTdG9yZWRDYXJ0KCkgew0KICAgdHJ5IHsNCiAgICAgIGNvbnN0IGNhcnQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKExPQ0FMU1RPUkFHRV9LRVlfTkFNRSkpDQogICAgICAvLyBSZXR1cm4gY2FydCBkYXRhIHdpdGhvdXQgY2hlY2tpbmcgZm9yIHRva2VuDQogICAgICByZXR1cm4gY2FydD8uZXZlbnQ/LmRhdGEgfHwgeyBpdGVtczogW10gfQ0KICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgICBpdGVtczogW10NCiAgICAgIH0NCiAgIH0NCn0NCg0KZnVuY3Rpb24gZmluZENhcnRDaGFuZ2VzKG9sZENhcnQsIG5ld0NhcnQpIHsNCiAgIHRyeSB7DQogICAgICBjb25zdCBvbmx5SW5MZWZ0ID0gKGwsIHIpID0+IGwuZmlsdGVyKGxpID0+ICFyLnNvbWUocmkgPT4gbGkua2V5ID09IHJpLmtleSkpOw0KICAgICAgbGV0IHJlc3VsdCA9IHsNCiAgICAgICAgIGFkZGVkOiBvbmx5SW5MZWZ0KG5ld0NhcnQuaXRlbXMsIG9sZENhcnQuaXRlbXMpLA0KICAgICAgICAgcmVtb3ZlZDogb25seUluTGVmdChvbGRDYXJ0Lml0ZW1zLCBuZXdDYXJ0Lml0ZW1zKSwNCiAgICAgIH07DQoNCiAgICAgIG9sZENhcnQuaXRlbXMuZm9yRWFjaChvaSA9PiB7DQogICAgICAgICBjb25zdCBuaSA9IG5ld0NhcnQuaXRlbXMuZmluZChpID0+IGkua2V5ID09IG9pLmtleSAmJiBpLnF1YW50aXR5ICE9IG9pLnF1YW50aXR5KTsNCiAgICAgICAgIGlmICghbmkpIHJldHVybjsNCiAgICAgICAgIGxldCBxdWFudGl0eSA9IG5pLnF1YW50aXR5IC0gb2kucXVhbnRpdHk7DQogICAgICAgICBsZXQgaXRlbSA9IHsgLi4ubmkgfTsNCiAgICAgICAgIGl0ZW0ucXVhbnRpdHkgPSBNYXRoLmFicyhxdWFudGl0eSk7DQogICAgICAgICBxdWFudGl0eSA+IDANCiAgICAgICAgICAgID8gcmVzdWx0LmFkZGVkLnB1c2goaXRlbSkNCiAgICAgICAgICAgIDogcmVzdWx0LnJlbW92ZWQucHVzaChpdGVtKQ0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgcmV0dXJuIG51bGwNCiAgIH0NCn0NCmNvbnN0IHV1aWQgPSAoKSA9PiB7DQogICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgew0KICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLA0KICAgICAgICAgdiA9IGMgPT0gJ3gnID8gciA6IChyICYgMHgzIHwgMHg4KTsNCiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTsNCiAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBvYnNlcnZlQ2FydENoYW5nZXMoKSB7DQogICBjb25zdCBjYXJ0T2JzZXJ2ZXIgPSBuZXcgUGVyZm9ybWFuY2VPYnNlcnZlcigobGlzdCkgPT4gew0KDQogICAgICBsaXN0LmdldEVudHJpZXMoKS5mb3JFYWNoKGFzeW5jIChlbnRyeSkgPT4gew0KICAgICAgICAgY29uc3QgaXNWYWxpZFJlcXVlc3RUeXBlID0gWyd4bWxodHRwcmVxdWVzdCcsICdmZXRjaCddLmluY2x1ZGVzKGVudHJ5LmluaXRpYXRvclR5cGUpOw0KICAgICAgICAgY29uc3QgaXNDYXJ0Q2hhbmdlUmVxdWVzdCA9IC9cL2NhcnRcLy8udGVzdChlbnRyeS5uYW1lKTsNCiAgICAgICAgIGlmIChpc1ZhbGlkUmVxdWVzdFR5cGUgJiYgaXNDYXJ0Q2hhbmdlUmVxdWVzdCkgew0KICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2NhcnQuanMnKTsNCiAgICAgICAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgICAgICAgICBjb25zdCBvbGRDYXJ0ID0gZ2V0U3RvcmVkQ2FydCgpOw0KDQogICAgICAgICAgICAvLyBPbmx5IGNyZWF0ZSBjbGVhbk9sZENhcnQgaWYgb2xkQ2FydCBoYXMgY29udGVudA0KICAgICAgICAgICAgY29uc3QgY2xlYW5PbGRDYXJ0ID0geyAuLi5vbGRDYXJ0IH07DQogICAgICAgICAgICBkZWxldGUgY2xlYW5PbGRDYXJ0LmNoYW5nZXM7DQoNCiAgICAgICAgICAgIGNhcnQuY2hhbmdlcyA9IGZpbmRDYXJ0Q2hhbmdlcyhvbGRDYXJ0LCBjYXJ0KTsNCiAgICAgICAgICAgIGNhcnQuY2hhbmdlcy5vbGRDYXJ0ID0gY2xlYW5PbGRDYXJ0OyAvLyBBZGQgY2xlYW4gdmVyc2lvbiBvZiBvbGQgY2FydA0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBldmVudCA9IHsNCiAgICAgICAgICAgICAgIGlkOiB1dWlkKCksDQogICAgICAgICAgICAgICBkYXRhOiBjYXJ0LA0KICAgICAgICAgICAgICAgdHlwZTogJ3N0YW5kYXJkJywNCiAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5Lm5hbWUgPT09ICdzdHJpbmcnICYmIGVudHJ5Lm5hbWUuaW5jbHVkZXMoJ2NhcnQvYWRkJykpIHsNCiAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9hZGRlZCI7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbnRyeS5uYW1lID09PSAnc3RyaW5nJyAmJiBlbnRyeS5uYW1lLmluY2x1ZGVzKCdjYXJ0L2NoYW5nZScpKSB7DQogICAgICAgICAgICAgICBpZiAoY2FydC5jaGFuZ2VzLmFkZGVkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9hZGRlZCI7DQogICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNhcnQuY2hhbmdlcy5yZW1vdmVkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9yZW1vdmVkIjsNCiAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBldmVudC5uYW1lID0gImNhcnRfY2hhbmdlZCI7DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKExPQ0FMU1RPUkFHRV9LRVlfTkFNRSwgSlNPTi5zdHJpbmdpZnkoeyBldmVudCB9KSkNCg0KICAgICAgICAgICAgaWYgKGV2ZW50Lm5hbWUgPT09ICJjYXJ0X2FkZGVkIikgew0KICAgICAgICAgICAgICAgLy8gVXNlIGNhcnQgYXMgcGF5bG9hZCBmb3IgY29uZGl0aW9uIGV2YWx1YXRpb24NCiAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHskaW5wdXQuY29uZGl0aW9ufSk7DQogICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb24gPSBldmFsKHskaW5wdXQuY29uZGl0aW9uLnN0cmluZ2lmaWVkfSk7DQoNCiAgICAgICAgICAgICAgIGlmIChjb25kaXRpb24gfHwgY29uZGl0aW9uID09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgU1VQRVJGTE9XLnN0YXJ0VHJpZ2dlcih7Y2FydH0pDQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgIH0NCiAgICAgIH0pOw0KICAgfSk7DQogICBjYXJ0T2JzZXJ2ZXIub2JzZXJ2ZSh7IGVudHJ5VHlwZXM6IFsicmVzb3VyY2UiXSB9KTsNCn0NCg0KDQpvYnNlcnZlQ2FydENoYW5nZXMoKQ==","input":{}},{"id":"f6f23f4d-5c08-4459-845b-e6d679f33436_hallwil-test-task.myshopify.com-test","sid":"258497904911","aid":"95d68bea-c90b-4894-84f3-57f5cf7f6f53","title":"Product Added","options":{},"blob":"Ly8gcHJvZHVjdCBhZGRlZCB0byBjYXJ0IHRyaWdnZXINCg0KY29uc3QgTE9DQUxTVE9SQUdFX0tFWV9OQU1FID0gJ19DQVJUJw0KDQpmdW5jdGlvbiBnZXRTdG9yZWRDYXJ0KCkgew0KICAgdHJ5IHsNCiAgICAgIGNvbnN0IGNhcnQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKExPQ0FMU1RPUkFHRV9LRVlfTkFNRSkpDQogICAgICAvLyBSZXR1cm4gY2FydCBkYXRhIHdpdGhvdXQgY2hlY2tpbmcgZm9yIHRva2VuDQogICAgICByZXR1cm4gY2FydD8uZXZlbnQ/LmRhdGEgfHwgeyBpdGVtczogW10gfQ0KICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgICBpdGVtczogW10NCiAgICAgIH0NCiAgIH0NCn0NCg0KZnVuY3Rpb24gZmluZENhcnRDaGFuZ2VzKG9sZENhcnQsIG5ld0NhcnQpIHsNCiAgIHRyeSB7DQogICAgICBjb25zdCBvbmx5SW5MZWZ0ID0gKGwsIHIpID0+IGwuZmlsdGVyKGxpID0+ICFyLnNvbWUocmkgPT4gbGkua2V5ID09IHJpLmtleSkpOw0KICAgICAgbGV0IHJlc3VsdCA9IHsNCiAgICAgICAgIGFkZGVkOiBvbmx5SW5MZWZ0KG5ld0NhcnQuaXRlbXMsIG9sZENhcnQuaXRlbXMpLA0KICAgICAgICAgcmVtb3ZlZDogb25seUluTGVmdChvbGRDYXJ0Lml0ZW1zLCBuZXdDYXJ0Lml0ZW1zKSwNCiAgICAgIH07DQoNCiAgICAgIG9sZENhcnQuaXRlbXMuZm9yRWFjaChvaSA9PiB7DQogICAgICAgICBjb25zdCBuaSA9IG5ld0NhcnQuaXRlbXMuZmluZChpID0+IGkua2V5ID09IG9pLmtleSAmJiBpLnF1YW50aXR5ICE9IG9pLnF1YW50aXR5KTsNCiAgICAgICAgIGlmICghbmkpIHJldHVybjsNCiAgICAgICAgIGxldCBxdWFudGl0eSA9IG5pLnF1YW50aXR5IC0gb2kucXVhbnRpdHk7DQogICAgICAgICBsZXQgaXRlbSA9IHsgLi4ubmkgfTsNCiAgICAgICAgIGl0ZW0ucXVhbnRpdHkgPSBNYXRoLmFicyhxdWFudGl0eSk7DQogICAgICAgICBxdWFudGl0eSA+IDANCiAgICAgICAgICAgID8gcmVzdWx0LmFkZGVkLnB1c2goaXRlbSkNCiAgICAgICAgICAgIDogcmVzdWx0LnJlbW92ZWQucHVzaChpdGVtKQ0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiByZXN1bHQ7DQogICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgcmV0dXJuIG51bGwNCiAgIH0NCn0NCmNvbnN0IHV1aWQgPSAoKSA9PiB7DQogICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgew0KICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLA0KICAgICAgICAgdiA9IGMgPT0gJ3gnID8gciA6IChyICYgMHgzIHwgMHg4KTsNCiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTsNCiAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBvYnNlcnZlQ2FydENoYW5nZXMoKSB7DQogICBjb25zdCBjYXJ0T2JzZXJ2ZXIgPSBuZXcgUGVyZm9ybWFuY2VPYnNlcnZlcigobGlzdCkgPT4gew0KDQogICAgICBsaXN0LmdldEVudHJpZXMoKS5mb3JFYWNoKGFzeW5jIChlbnRyeSkgPT4gew0KICAgICAgICAgY29uc3QgaXNWYWxpZFJlcXVlc3RUeXBlID0gWyd4bWxodHRwcmVxdWVzdCcsICdmZXRjaCddLmluY2x1ZGVzKGVudHJ5LmluaXRpYXRvclR5cGUpOw0KICAgICAgICAgY29uc3QgaXNDYXJ0Q2hhbmdlUmVxdWVzdCA9IC9cL2NhcnRcLy8udGVzdChlbnRyeS5uYW1lKTsNCiAgICAgICAgIGlmIChpc1ZhbGlkUmVxdWVzdFR5cGUgJiYgaXNDYXJ0Q2hhbmdlUmVxdWVzdCkgew0KICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnL2NhcnQuanMnKTsNCiAgICAgICAgICAgIGNvbnN0IGNhcnQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7DQogICAgICAgICAgICBjb25zdCBvbGRDYXJ0ID0gZ2V0U3RvcmVkQ2FydCgpOw0KDQogICAgICAgICAgICAvLyBPbmx5IGNyZWF0ZSBjbGVhbk9sZENhcnQgaWYgb2xkQ2FydCBoYXMgY29udGVudA0KICAgICAgICAgICAgY29uc3QgY2xlYW5PbGRDYXJ0ID0geyAuLi5vbGRDYXJ0IH07DQogICAgICAgICAgICBkZWxldGUgY2xlYW5PbGRDYXJ0LmNoYW5nZXM7DQoNCiAgICAgICAgICAgIGNhcnQuY2hhbmdlcyA9IGZpbmRDYXJ0Q2hhbmdlcyhvbGRDYXJ0LCBjYXJ0KTsNCiAgICAgICAgICAgIGNhcnQuY2hhbmdlcy5vbGRDYXJ0ID0gY2xlYW5PbGRDYXJ0OyAvLyBBZGQgY2xlYW4gdmVyc2lvbiBvZiBvbGQgY2FydA0KICAgICAgICAgICAgDQogICAgICAgICAgICBjb25zdCBldmVudCA9IHsNCiAgICAgICAgICAgICAgIGlkOiB1dWlkKCksDQogICAgICAgICAgICAgICBkYXRhOiBjYXJ0LA0KICAgICAgICAgICAgICAgdHlwZTogJ3N0YW5kYXJkJywNCiAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5Lm5hbWUgPT09ICdzdHJpbmcnICYmIGVudHJ5Lm5hbWUuaW5jbHVkZXMoJ2NhcnQvYWRkJykpIHsNCiAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9hZGRlZCI7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbnRyeS5uYW1lID09PSAnc3RyaW5nJyAmJiBlbnRyeS5uYW1lLmluY2x1ZGVzKCdjYXJ0L2NoYW5nZScpKSB7DQogICAgICAgICAgICAgICBpZiAoY2FydC5jaGFuZ2VzLmFkZGVkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9hZGRlZCI7DQogICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNhcnQuY2hhbmdlcy5yZW1vdmVkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgIGV2ZW50Lm5hbWUgPSAiY2FydF9yZW1vdmVkIjsNCiAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBldmVudC5uYW1lID0gImNhcnRfY2hhbmdlZCI7DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKExPQ0FMU1RPUkFHRV9LRVlfTkFNRSwgSlNPTi5zdHJpbmdpZnkoeyBldmVudCB9KSkNCg0KICAgICAgICAgICAgaWYgKGV2ZW50Lm5hbWUgPT09ICJjYXJ0X2FkZGVkIikgew0KICAgICAgICAgICAgICAgLy8gVXNlIGNhcnQgYXMgcGF5bG9hZCBmb3IgY29uZGl0aW9uIGV2YWx1YXRpb24NCiAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHskaW5wdXQuY29uZGl0aW9ufSk7DQogICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb24gPSBldmFsKHskaW5wdXQuY29uZGl0aW9uLnN0cmluZ2lmaWVkfSk7DQoNCiAgICAgICAgICAgICAgIGlmIChjb25kaXRpb24gfHwgY29uZGl0aW9uID09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgU1VQRVJGTE9XLnN0YXJ0VHJpZ2dlcih7Y2FydH0pDQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgIH0NCiAgICAgIH0pOw0KICAgfSk7DQogICBjYXJ0T2JzZXJ2ZXIub2JzZXJ2ZSh7IGVudHJ5VHlwZXM6IFsicmVzb3VyY2UiXSB9KTsNCn0NCg0KDQpvYnNlcnZlQ2FydENoYW5nZXMoKQ==","input":{}}]}};function customSplitPath(e){const t=[];let r="",n=0,s=0,o=0;for(let i=0;i<e.length;i++){const a=e[i];"("===a?(n++,r+=a):")"===a?(n=Math.max(n-1,0),r+=a):"["===a?(s++,r+=a):"]"===a?(s=Math.max(s-1,0),r+=a):"{"===a?(o++,r+=a):"}"===a?(o=Math.max(o-1,0),r+=a):"."===a&&0===n&&0===s&&0===o?(t.push(r),r=""):r+=a}return r&&t.push(r),t}function extractCodeVariablesOld(e){const t={};try{const r=/\{\$input\.[^{}]*?(?:\{[^{}]*\}[^{}]*?)*?\}/g;let n;for(;null!==(n=r.exec(e));){n[0].replace("{$input.","").replace("}","");t[n[0]]=n[0]}return t}catch(e){return console.error("error in extractCodeVariables:",e.message),t}}function extractCodeVariables(e){const t={};try{const r=/\{\$(?:input|system|user|app)\.[^{}]*?\}/g;let n;for(;null!==(n=r.exec(e));)t[n[0]]=n[0];return t}catch(e){return console.error("error in extractCodeVariables:",e.message),t}}function decodeBase64(e){try{const t=atob(e),r=Uint8Array.from(t,(e=>e.charCodeAt(0)));return(new TextDecoder).decode(r)}catch(e){return console.log("error in decode:",e.message),!1}}function generateCondition(e,t,r){try{if(!Array.isArray(t)||0===t.length)return e;if(!r||"object"!=typeof r)return e;const{esacapeKeys:n,escapeValues:s,escapeStart:o='"',escapeEnd:i='"',multiConditionFormat:a,singleConditionFormat:c,operators:l,logicalOperators:u}=r;if(!a||!c)return e;if(!l||!u)return e;const p=[],f=e=>{"string"==typeof e&&(e=e.toLowerCase());let t=!isNaN(e)&&!isNaN(parseFloat(e)),r="true"===e||"false"===e,n=("string"==typeof e&&e.length,null==e),s=!1,o=!1;try{const t=JSON.parse(e);s=Array.isArray(t)}catch(e){s=!1}try{const t=JSON.parse(e);o="object"==typeof t&&null!==t}catch(e){o=!1}return!(t||r||n||s||o)};return t.forEach(((e,r)=>{const{conditions:d=[],connector:g}=e;if(!Array.isArray(d)||0===d.length)return;const h=[];d.forEach(((e,t)=>{const{key:r,operator:a,value:p,connector:g}=e;if(!r||!a||null==p)return;const y=l[a];if(!y)return;let m=r,S=p;n&&f(m)&&(m=`${o}${m}${i}`),s&&f(S)&&(S=`${o}${S}${i}`);const v=y.replace(/@@field@@/g,m).replace(/@@value@@/g,S),_=c.replace(/@@operator@@/g,v);if(h.push(_),t<d.length-1){const e=u[g]||g||"AND";h.push(e)}}));const y=h.join(" "),m=a.replace(/@@conditions@@/g,y);if(p.push(m),r<t.length-1){const e=u[g]||g||"AND";p.push(e)}})),p.join(" ")}catch(t){return console.log("error in generateCondition function:",t.message),e}}function replaceCondition(e){if(!e||"object"!=typeof e)return e;if(!["map","stringified"].every((t=>e.hasOwnProperty(t))))return e;try{let t="(s)";if(!e.hasOwnProperty(t)&&(t="_(s)_",!e.hasOwnProperty(t)))return e.stringified||e;const r=decodeBase64(e[t]);if(!r)return e.stringified||e;const n=JSON.parse(r);if(!n||"object"!=typeof n)return e.stringified||e;return generateCondition(e.stringified,e.map,n)}catch(t){return console.error("error in replaceCondition function:",t.message),e.stringified||e}}function parseCodeTemplateVariables(e,t){try{const r=extractCodeVariables(e);return parseTemplate(r,t)}catch(e){console.error("error in parseCodeTemplateVariables:",e.message)}}function toJSLiteral(e){return"string"==typeof e?JSON.stringify(e):"number"==typeof e||"boolean"==typeof e?String(e):"object"==typeof e?JSON.stringify(e):String(e)}async function replaceVariablesInCode(e,t){try{const r=parseCodeTemplateVariables(e,t);Object.keys(r).forEach((t=>{try{const n=toJSLiteral(r[t]),s=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),o=new RegExp(`(["'])?${s}\\1?`,"g");e=e.replace(o,n)}catch(e){console.log("error in replaceVariablesInCode.forEach:",e.message)}})),e=e.replace(/(["'])?\{\$input\.[^}]+\}\1?/g,"undefined")}catch(e){console.error("error in replaceVariablesInCode:",e.message)}finally{return e}}function parseTemplate(e,t){const r=analysNIndex(e,t);return t&&"object"==typeof t?0===Object.keys(t).length?t:doParse(r,t):t}function doParse(e,t){if(null!=e){if(Array.isArray(e)){const r=[];for(const n of e){const e=doParse(n,t);void 0!==e&&r.push(e)}return r.length?r:void 0}if("object"==typeof e){const r={};for(const n of Object.keys(e)){const s=doParse(e[n],t);void 0!==s&&(r[n]=s)}return Object.keys(r).length?r:void 0}return"string"==typeof e?handleStringTemplate(e,t):e}}function handleStringTemplate(e,t){const r=e.match(/^\{\$([^}]+)\}$/);return r?resolveSinglePlaceholderWithModifiers(r[1],t):replaceMultiplePlaceholders(e,t)}function resolveSinglePlaceholderWithModifiers(e,t){const[r,...n]=e.split("|").map((e=>e.trim())),s="input.";if(!r.startsWith(s))return;let o=getValueByBracketPath(t,r.slice(6));if(null!=o){for(const e of n){const t=applyModifier(o,e);if(void 0===t)return;o=t}return o}}function replaceMultiplePlaceholders(e,t){let r=!1;const n=e.replace(/\{\$([^}]+)\}/g,((e,n)=>{const[s,...o]=n.split("|").map((e=>e.trim())),i="input.";if(!s.startsWith(i))return r=!0,"";const a=s.slice(6);let c=getValueByBracketPath(t,a);if(null==c)return r=!0,"";for(const e of o){const t=applyModifier(c,e);if(null==t)return r=!0,"";c=t}return c&&"object"==typeof c&&(c=JSON.stringify(c)),String(c)}));if(!r)return n}function applyModifier(e,t){const[r,...n]=t.split(":").map((e=>e.trim())),s=modifiersMap[r];if(!s)return console.warn(`Unknown modifier: ${r}`),e;return s(e,...n.join(" ").split(/,(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).reduce(((e,t)=>{const r=t.trim();return r&&e.push(r),e}),[]).map((e=>e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e)))}function getValueByBracketPath(e,t){const r=t.split(".").flatMap((e=>e.split(/\[|\]/).filter(Boolean)));let n=e;for(const e of r){if(null==n||!(e in n))return;n=n[e]}return n}function strftime(e,t){const r=new Date(e);if(isNaN(r.getTime()))return e;const n=r.getDay(),s=r.getDate(),o=r.getMonth(),i=r.getFullYear(),a=String(i).slice(-2),c=r.getHours(),l=c%12||12,u=r.getMinutes(),p=r.getSeconds(),f=c<12?"AM":"PM";function d(e){return e<10?`0${e}`:String(e)}const g={"%Y":String(i),"%y":a,"%m":d(o+1),"%d":d(s),"%H":d(c),"%I":d(l),"%M":d(u),"%S":d(p),"%p":f,"%a":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n],"%A":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n],"%b":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o],"%B":["January","February","March","April","May","June","July","August","September","October","November","December"][o],"%c":r.toString(),"%%":"%"};let h=t;for(const[e,t]of Object.entries(g))h=h.replaceAll(e,t);return h}function analysNIndex(e,t){const r=/^(?:["']?\{\$input\.(.*)\}["']?)$/;function n(e){const t=e.match(r);return t?t[1]:null}function s(e,t){const r=function(e){const t=e.split("."),r=[];for(const e of t){const t=e.split(/\[|\]/).filter(Boolean);r.push(...t)}return r}(t);let n=e;for(const e of r){if(null==n||!(e in n))return;n=n[e]}return n}const o=JSON.parse(JSON.stringify(e));let i=!0;for(;i;)i=!1,a(o);return function e(r){if(null==r)return;if(Array.isArray(r)){for(let t=0;t<r.length;t++)e(r[t]);return}if("object"==typeof r){for(const t of Object.keys(r))e(r[t]);return}if("string"==typeof r){const e=n(r);if(!e)return;s(t,e)}}(o),function e(t){if(null==t)return null;if(Array.isArray(t)){for(let r=0;r<t.length;r++)t[r]=e(t[r]),null==t[r]&&(t.splice(r,1),r--);return t.length>0?t:null}if("object"==typeof t){for(const r of Object.keys(t))t[r]=e(t[r]),null==t[r]&&delete t[r];return Object.keys(t).length>0?t:null}return t}(o),o;function a(e){if(Array.isArray(e)){if(1===e.length){const n=c(e[0]);if(n){const o=s(t,n);if(Array.isArray(o)){const t=e[0];e.length=0;for(let s=0;s<o.length;s++){const o=(r=t,JSON.parse(JSON.stringify(r)));l(o,n,s),e.push(o)}return void(i=!0)}}}for(let t=0;t<e.length;t++)a(e[t])}else{var r;if(e&&"object"==typeof e)for(const t of Object.keys(e))a(e[t])}}function c(e){if(null==e)return null;if("string"==typeof e){const t=n(e);if(!t)return null;let r=t.indexOf("{n}");if(r<0&&(r=t.indexOf("[n]"),r<0))return null;let s=t.slice(0,r);return(s.endsWith(".")||s.endsWith("["))&&(s=s.slice(0,-1)),s}if(Array.isArray(e)){for(const t of e){const e=c(t);if(e)return e}return null}if("object"==typeof e)for(const t of Object.values(e)){const e=c(t);if(e)return e}return null}function l(e,t,r){if(null==e)return e;if("string"==typeof e){const s=n(e);if(!s)return e;const o=t+".{n}",i=t+"[n]";if(s.startsWith(o)){return u(e,s.replace(o,t+"."+r))}if(s.startsWith(i)){return u(e,s.replace(i,t+"["+r+"]"))}return e}if(Array.isArray(e)){for(let n=0;n<e.length;n++)e[n]=l(e[n],t,r);return e}if("object"==typeof e){for(const n of Object.keys(e))e[n]=l(e[n],t,r);return e}return e}function u(e,t){return e.startsWith('"')?`"{$input.${t}}"`:e.startsWith("'")?`'{$input.${t}}'`:`{$input.${t}}`}}let modifiersMap={date:(e,t)=>t?"string"!=typeof e?e:strftime(e,t):e,replace:(e,t,r)=>{if("string"!=typeof e)return e;if("string"!=typeof t)return e;if("string"!=typeof r)return e;if(!t||!r)return e;const n=new RegExp(t,"g");return e.replace(n,r)},replace_first:(e,t,r)=>{if("string"!=typeof e)return e;if("string"!=typeof t)return e;if("string"!=typeof r)return e;if(!t||!r)return e;const n=new RegExp(t);return e.replace(n,r)},replaceRegx:(e,t,r)=>{const n=new RegExp(t,"g");return e.replace(n,r)},reverse:e=>Array.isArray(e)?e.reverse():e,toJson:e=>JSON.stringify(e),toString:e=>String(e),toNumber:e=>{const t=Number(e);return Number.isNaN(t)?void 0:t},toBoolean:e=>Boolean(e),uppercase:e=>"string"==typeof e?e.toUpperCase():e,lowercase:e=>"string"==typeof e?e.toLowerCase():e,capitalize:e=>"string"==typeof e&&e.length?e.split(/\s+/g).map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "):e,camelcase:e=>"string"!=typeof e?e:e.toLowerCase().split(/\s+/g).map(((e,t)=>0===t?e:e[0].toUpperCase()+e.slice(1))).join(""),join:(e,t=",")=>Array.isArray(e)?e.join(t):e};const USER_PROPERTIES={loggedIn:window?._sfProperties?.loggedIn||!1,userid:window?._sfProperties?.userid||null,firstname:window?._sfProperties?.firstname||null,lastname:window?._sfProperties?.lastname||null,email:window?._sfProperties?.email||null},PUBLIC_PROPERTIES={url:window.location.href,title:document.title,language:navigator.language,...window?._sfProperties||{}};class Helper{cookieToObj(){try{const e=document.cookie.split(";"),t={};for(const r of e){const[e,n]=r.split("=");t[e.trim()]=n}return t}catch(e){return{}}}setCookie(e,t,r={}){try{const t=()=>{if("string"==typeof r.expires)return r.expires;const e=parseFloat(r.expires),t=new Date;return t.setTime(t.getTime()+60*e*1e3),e>0?t.toUTCString():void 0},n="object"==typeof r?.value___placeholdered||Array.isArray(r?.value___placeholdered);let s={[e]:n?encodeURIComponent(JSON.stringify(r?.value___placeholdered)):encodeURIComponent(r?.value___placeholdered||""),path:"string"==typeof r.path&&r.path.trim().length>0?r.path:"/",expires:t(),...r.domain&&{Domain:r.domain},...!0===r.secure||"true"===r.secure?{Secure:""}:{},...r.sameSite&&{SameSite:r.sameSite},...r.priority&&{Priority:r.priority},...!0===r.partitioned||"true"===r.partitioned?{Partitioned:""}:{}},o=Object.entries(s).map((([e,t])=>"Secure"===e||"Partitioned"===e?e:`${e}=${t}`)).join("; ");return document.cookie=o,!0}catch(e){return!1}}getCookie(e){try{const t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));if(t){const e=decodeURIComponent(t[1]);try{return JSON.parse(e)}catch(t){return e}}return}catch(e){return}}deleteCookie(e,t={}){try{const r={expires:new Date(0).toUTCString()};if(null!==t.path&&""!==t.path&&null!==t.domain&&""!==t.domain)return r.Path=t.path,r.Domain=t.domain,this.setCookie(e,"",r),!0;null==t.domain&&""==t.domain||(r.Domain=t.domain);const n=["/",""];return null!=t.path&&""!=t.path&&(n.length=0,n.push(t.path)),n.forEach((t=>{t?r.path=t:delete r.path,this.setCookie(e,"",r)})),!0}catch(e){return!1}}listCookies(){const e=this.cookieToObj();return Object.entries(e).map((([e,t])=>{let r;try{const e=decodeURIComponent(t);r=JSON.parse(e)}catch(n){console.error(`Error parsing cookie "${e}":`,n),r=decodeURIComponent(t)}return{name:e,value:r}}))}}const helpers=new Helper;class Events{key="__SF_EVENTS";map={product_added_to_cart:"carts/create",product_removed_from_cart:"carts/update",checkout_started:"checkout/start",checkout_completed:"checkout/end",cart_viewed:"pageview",product_viewed:"pageview"};pageview({options:e,execution:t,...r},n){return"object"==typeof PUBLIC_PROPERTIES&&Object.keys(PUBLIC_PROPERTIES).length>0?PUBLIC_PROPERTIES:{}}watch(e=(()=>{})){try{let t=localStorage.getItem(this.key);setInterval((()=>{const r=localStorage.getItem(this.key);if(t!==r){try{let{event:t}=JSON.parse(r)||{};if("object"==typeof t?.context&&null!==t?.context&&delete t.context,t?.clientId&&delete t.clientId,t?.name){const e=this.map[t.name];e&&(t.name=e)}"function"==typeof e&&e(t||{})}catch(e){console.log("[SUPERFLOW ERROR][Events.watch][parse.event]:",e.message)}t=r}}),50)}catch(e){console.log("[SUPERFLOW ERROR][Events.watch]:",e.message)}}}class ClientFunctions{constructor(e){this.server=e}console_log(e){new Function(`console.log(\`${e?.options?.message||null}\`)`)();return this.server.send(JSON.stringify({results:{message:e.options.message},nextStepId:e.nextsteps[0],fid:e?.fid,_template_variables:{message:e?.options?.message}}))}run_code(e){try{const t=new Function(`${e?.options?.code||""}`)();return this.server.send(JSON.stringify({results:{output:t||"void"},nextStepId:e?.nextsteps[0],_template_variables:{result:t}}))}catch(t){return this.server.send(JSON.stringify({results:{code:e?.options?.code,error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{result:t.message}}))}}redirect_to_url(e){try{if("object"==typeof e?.options&&e.options.hasOwnProperty("url")){"true"===e?.options?.new_tab||!0===e?.options?.new_tab?window.open(e.options.url,"_blank"):window.location.href=e.options.url}return this.server.send(JSON.stringify({results:{executed:!0},nextStepId:e.nextsteps[0],_template_variables:{result:e?.options?.url}}))}catch(t){return this.server.send(JSON.stringify({results:{error:t.message},nextStepId:e.nextsteps[0],_template_variables:{result:t.message}}))}}set_cookie(e){try{const t=e?.options||{},r=t.name,n=t.value,s={};if(Object.keys(t).forEach((e=>{"name"!==e&&"value"!==e&&("expires"!==e||isNaN(t[e])?s[e]=t[e]:s[e]=Number(t[e]))})),!r)throw new Error("Cookie name is required");const o=helpers.setCookie(r,n,s);return this.server.send(JSON.stringify({results:{success:o,name:r,value:n,options:s},nextStepId:e?.nextsteps[0],_template_variables:{success:o,name:r,value:n}}))}catch(t){return this.server.send(JSON.stringify({results:{error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{error:t.message}}))}}get_cookie(e){try{const{name:t}=e?.options||{};if(!t)throw new Error("Cookie name is required");const r=helpers.getCookie(t);return this.server.send(JSON.stringify({results:{success:void 0!==r,name:t,value:r},nextStepId:e?.nextsteps[0],_template_variables:{success:void 0!==r,name:t,value:r}}))}catch(t){return this.server.send(JSON.stringify({results:{error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{error:t.message}}))}}delete_cookie(e){try{const{name:t,path:r,domain:n}=e?.options||{};if(!t)throw new Error("Cookie name is required");const s=helpers.deleteCookie(t,{path:r,domain:n});return this.server.send(JSON.stringify({results:{success:s,name:t,path:r,domain:n},nextStepId:e?.nextsteps[0],_template_variables:{success:s,name:t,path:r,domain:n}}))}catch(t){return this.server.send(JSON.stringify({results:{error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{error:t.message}}))}}list_cookies(e){try{const t=helpers.listCookies();return this.server.send(JSON.stringify({results:{success:!0,cookies:t},nextStepId:e?.nextsteps[0],_template_variables:{cookies:JSON.stringify(t)}}))}catch(t){return this.server.send(JSON.stringify({results:{error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{error:t.message}}))}}async apply_coupon(e){try{const t=e?.options?.code;if(!t)throw new Error("Coupon code is required");if(!(await fetch("/discount/"+t,{method:"GET",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to apply coupon code");return this.server.send(JSON.stringify({results:{success:!0,message:`Coupon code ${t} applied successfully. Previous coupon might be replaced.`},nextStepId:e?.nextsteps[0],_template_variables:{code:t,success:!0}}))}catch(t){return this.server.send(JSON.stringify({results:{success:!1,error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{code:e?.options?.code,success:!1,error:t.message}}))}}async remove_coupon(e){try{const t=e?.options?.code;if(t){const r=helpers.getCookie("discount_code");if(!r||r!==t)return this.server.send(JSON.stringify({results:{success:!1,message:`Coupon code ${t} is not currently applied`},nextStepId:e?.nextsteps[0],_template_variables:{code:t,success:!1}}))}if(!(await fetch("/discount/clear"+(t?`/${encodeURIComponent(t)}`:""),{method:"GET",headers:{"Content-Type":"application/json"}})).ok)throw new Error(t?`Failed to remove coupon code ${t}`:"Failed to remove coupon");return this.server.send(JSON.stringify({results:{success:!0,message:t?`Coupon code ${t} removed successfully`:"Coupon removed successfully"},nextStepId:e?.nextsteps[0],_template_variables:{code:t,success:!0}}))}catch(t){return this.server.send(JSON.stringify({results:{success:!1,error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{code:e?.options?.code,success:!1}}))}}get_coupon(e){try{const t=helpers.getCookie("discount_code");return this.server.send(JSON.stringify({results:{success:!0,code:t||null},nextStepId:e?.nextsteps[0],_template_variables:{success:!0,code:t||null}}))}catch(t){return this.server.send(JSON.stringify({results:{success:!1,error:t.message},nextStepId:e?.nextsteps[0],_template_variables:{success:!1,error:t.message}}))}}async#e(e){return new Promise(((t,r)=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.onerror=e=>{r(e)},n.readAsText(e)}))}async evaluteContent(e,t){try{const r=Object.getPrototypeOf((async function(){})).constructor;function n(e){return new r("SUPERFLOW",e)}const s=n(t);return await s(e)}catch(o){return{error:o.message}}}async custom(e){try{const t=await this.#e(e),r={},n=await this.evaluteContent(r,t);if(n?.error)throw new Error(n.error);return this.server.send(JSON.stringify({results:n||{}}))}catch(e){return this.server.send(JSON.stringify({results:{error:e.message}}))}}}class Connector{constructor(){const e=new URL(window.location.href).host;e&&e.includes("localhost")||e.includes("127.0.0.1")?this.url="ws://127.0.0.1:8787/v1/client/flows":this.url="wss://processor.superflow.workers.dev/v1/client/flows",this.server=null,this.client_id="__SUPERFLOW_CLIENT_ID__"}connect(e=[],t,r){const n=new WebSocket(`${this.url}?client_id=${this.client_id}`);return n.onopen=()=>{this.server=n,t.user=USER_PROPERTIES,this.server.send(JSON.stringify({flows:e||[],trigger:t}))},n.onmessage=e=>{"function"==typeof r&&r(e,n)},n}}const run=()=>{try{if("object"!=typeof SUPERFLOWEvs||0===Object.keys(SUPERFLOWEvs).length)return;new Helper;const e=new Events,t=new Connector,r=(e,t={})=>{try{const r=e.match(/{.*?}/g);if(!r||!Array.isArray(r)||0===r.length)return e;const n=(e,t)=>{const r=e.split(".");let n=t;for(const e of r){if(!n||"object"!=typeof n)return;n=n[e]}return n};for(const s of r){const r=n(s.slice(1,-1),t),o=null!=r?r.toString():"null";e=e.replace(new RegExp(s,"g"),o)}return e}catch(t){return console.log("[SUPERFLOW ERROR][Replace Variables]: ",t.message),e}},n=(e,t)=>{try{if("object"!=typeof PUBLIC_PROPERTIES||0===Object.keys(PUBLIC_PROPERTIES).length)throw new Error("No public properties found");e=r(e,{[t]:PUBLIC_PROPERTIES,user:USER_PROPERTIES});return new Function(e)()}catch(t){return console.log("[SUPERFLOW ERROR][Condition Evaluation]: ",t.message,e),!1}},s=async(e,t)=>{try{const r=Object.getPrototypeOf((async function(){})).constructor;const n=function(e){return new r("SUPERFLOW",e)}(t);return n(e)}catch(e){return{error:e.message}}};const o=async e=>{try{e=e.filter((e=>e?.blob)).map((e=>({...e,blob:atob(e.blob)})));let r=[];e.forEach((async e=>{if("string"==typeof e?.id&&"string"==typeof e?.aid&&e.id.endsWith("-test")){const t=function(e){try{const t=new URL(window.location.href),r=new URLSearchParams(t.search).get("superflow-testing");return document&&document.addEventListener("DOMContentLoaded",(()=>{r===e?.aid&&document.querySelectorAll("a").forEach((e=>{const t=new URL(e.href);t.searchParams.set("superflow-testing",r),e.href=t.href}))})),r===e?.aid}catch(e){return console.log("error in handleTestUrl",e.message),!0}}(e);if(!t)return}const n={};Object.defineProperty(n,"id",{value:e.id,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(n,"startTrigger",{value:(r={})=>((e,r)=>{t.connect(e,{event:"custom",results:r||{}},((e,t)=>{try{const r=new ClientFunctions(t);try{const{step:n,completed:s,start:o}=JSON.parse(e.data);n?.id&&"function"==typeof r[n?.event]&&(console.log("here 2.."),r[n?.event](n)),s&&t.close()}catch(t){e.data instanceof Blob&&r.custom(e.data)}}catch(e){console.log("error in server.addEventListener",e.message)}}))})([{...e,blob:void 0,input:void 0}],r),writable:!1,enumerable:!1,configurable:!1}),Object.freeze(n),new Proxy(n,{set:function(e,t,r){throw new Error("Superflow Runtime Object is read-only, please don't overwrite it or contact superflow support!")}}),e?.input&&"object"==typeof e?.input&&(e.blob=await replaceVariablesInCode(e.blob,e.input));const o=`\n          document.addEventListener("DOMContentLoaded", () => {\n            (async () => {\n              try {\n                ${e.blob}\n              } catch (error) {\n                console.error(error);\n              }\n              })()\n            });\n          `;r.push(s(n,o))})),document&&await Promise.allSettled(r)}catch(e){console.log("error in watchCustom",e.message)}};let i=[],a={};for(const[e,t]of Object.entries(SUPERFLOWEvs))if(Object.entries(t).filter((([e,t])=>"pageview"!==e)).map((([e,t])=>{a[e]=t})).flat(),t?.custom&&(Array.isArray(t.custom)&&t.custom.length>0&&o(t.custom),delete a.custom),Array.isArray(t?.pageview)&&t?.pageview.length>0)for(const e of t.pageview){const t=e?.options?.condition;if("string"==typeof t&&t.length>0){n(t,e?.title)&&i.push(e)}else i.push(e)}if(i.length>0){i=i.flat();const e=t.connect(i,{event:"pageview",results:"undefined"!=typeof SUPERFLOW_TRIGGER_PAYLOAD?SUPERFLOW_TRIGGER_PAYLOAD:PUBLIC_PROPERTIES});e.addEventListener("message",(t=>{try{const r=new ClientFunctions(e);try{const{step:n,completed:s,start:o}=JSON.parse(t.data);if(n?.id){"function"==typeof r[n?.event]&&r[n?.event](n)}s&&e.close()}catch(e){t.data instanceof Blob&&r.custom(t.data)}}catch(e){}}))}const c=e=>{try{const t=new Function(e);return t()}catch(e){return console.log("[SUPERFLOW ERROR][Events Condition Evaluation]: ",e.message),!1}},l=e=>{try{"pageview"===e?.name&&"object"==typeof window._sfProperties&&Object.keys(window._sfProperties).length>0&&(window._sfProperties.page_data=e?.data||{});if(!a[e?.name])return;const n=Object.values(a[e?.name])||[];if(Array.isArray(n)&&n?.length>0){let s=[];for(const t of n){const n=t?.options?.condition;if("string"==typeof n&&n.length>0){const o=r(n,{user:USER_PROPERTIES,[t?.title||"unknown"]:e?.data||{}});c(o)&&s.push(t)}else s.push(t)}if(0===s.length)return;const o=t.connect(s,{event:e?.name,results:e?.data||e});o.addEventListener("message",(e=>{try{const t=new ClientFunctions(o);try{const{step:r,completed:n,start:s}=JSON.parse(e.data);if(r?.id){"function"==typeof t[r?.event]&&t[r?.event](r)}n&&o.close()}catch(r){e.data instanceof Blob&&t.custom(e.data)}}catch(e){console.log("error in server.addEventListener",e.message)}}))}}catch(e){console.log("[SUPERFLOW ERROR][Watch Events]: ",e.message)}};if("undefined"==typeof SUPERFLOW_TRIGGER_PAYLOAD)e.watch(l);else for(const[e,t]of Object.entries(SUPERFLOWEvs))for(const[e,r]of Object.entries(t))l({name:e,data:SUPERFLOW_TRIGGER_PAYLOAD});new PerformanceObserver((e=>{e.getEntries().forEach((async e=>{const t=["xmlhttprequest","fetch"].includes(e.initiatorType),r=/\/cart\//.test(e.name);if(t&&r){const t=await fetch("/cart.js"),r=await t.json(),n=function(){try{const e=JSON.parse(localStorage.getItem("__SF_EVENTS"));return e?.event?.data?.token?e?.event?.data:{items:[]}}catch(e){return{items:[]}}}();r.changes=function(e,t){try{const r=(e,t)=>e.filter((e=>!t.some((t=>e.key==t.key))));let n={added:r(t.items,e.items),removed:r(e.items,t.items)};return e.items.forEach((e=>{const r=t.items.find((t=>t.key==e.key&&t.quantity!=e.quantity));if(!r)return;let s=r.quantity-e.quantity,o={...r};o.quantity=Math.abs(s),s>0?n.added.push(o):n.removed.push(o)})),n}catch(e){return null}}(n,r);const s={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),data:r,name:"product_removed_from_cart",type:"standard",timestamp:(new Date).toISOString()};if("string"==typeof e.name&&e.name.includes("cart/add"))s.name="product_added_to_cart";else if("string"==typeof e.name&&e.name.includes("cart/change")){const e=r.changes.added.length>0;s.name=e?"product_added_to_cart":"product_removed_from_cart"}localStorage.setItem("__SF_EVENTS",JSON.stringify({event:s}))}}))})).observe({entryTypes:["resource"]})}catch(e){console.log("[SUPERFLOW ERROR]: ",e.message)}};run();</script>